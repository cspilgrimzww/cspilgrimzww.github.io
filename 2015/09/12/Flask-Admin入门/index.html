<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<!--
***************  *      *     *
      8          *    *       *
      8          *  *         *
      8          **           *
      8          *  *         *
      8          *    *       *
      8          *      *     *
      8          *        *   ***********    -----Theme By Kieran(http://go.kieran.top)
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<!--<![endif]-->

<head>
  <title>Flask-Admin入门 | Weiwei Zhong&#39;s blog</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Weiwei Zhong's blog">
    <meta name="author" content="钟蔚蔚">
    <meta name="description" content="Tyrion" />
    <meta name="keywords" content="" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="Weiwei Zhong&#39;s blog" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
	
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    
    

    <!-- Custom stylesheet, (add custom styles here, always load last) -->
    <!-- Load our stylesheet for IE8 -->
    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- Google Webfonts (Monserrat 400/700, Open Sans 400/600) -->
    <link href='//fonts.useso.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
    <link href='//fonts.useso.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'>

    <!-- Load our fonts individually if IE8+, to avoid faux bold & italic rendering -->
    <!--[if IE]>
    <link href='http://fonts.useso.com/css?family=Montserrat:400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Montserrat:700' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Open+Sans:400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Open+Sans:600' rel='stylesheet' type='text/css'>
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->










  
  
  

  
  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            <li>
                <a class="sb-toggle-submenu">Works<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                        <li><a href="http://www.nodebeginner.org/index-zh-cn.html" target="_BLANK" class="animsition-link">node</a></li>
                    
                        <li><a href="http://dillinger.io/" target="_BLANK" class="animsition-link">Online Markdown Editor</a></li>
                    
                </ul>
            </li>
            
            
            
            <li>
                <a class="sb-toggle-submenu">Links<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                    <li><a href="http://blog.liqilei.com/" class="animsition-link">Qilei Li</a></li>
                    
                    <li><a href="http://go.kieran.top/" class="animsition-link">Kieran</a></li>
                    
                    <li><a href="http://pangjiuzala.github.io/" class="animsition-link">Xing Liu</a></li>
                    
                    <li><a href="http://www.changhuiyuan.com/" class="animsition-link">Huiyuan Chang</a></li>
                    
                    <li><a href="http://www.jianshu.com/users/2e5186b9dd1c/latest_articles" class="animsition-link">Ke Xu</a></li>
                    
                </ul>
            </li>
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            <li><a href="/about.html" class="animsition-link" title="about">About</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/profile.png" alt="Logo" width="35px;"/> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">Weiwei Zhong's blog</a></li>
                            <li class="nolink"><span>Always </span>Creative.</li>
                            
                            <li><a href="https://github.com/cspilgrimzww" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            
                            
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->

        <!-- ============================ Hero Image =========================== -->

        <section id="hero" class="scrollme">
            <div class="container-fluid element-img" style="background: url(/img/bg_img.jpg) no-repeat center center fixed;background-size: cover">
                <div class="row">
                    <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-8 col-md-offset-2 vertical-align cover boost text-center">
                        <div class="center-me animateme" data-when="exit" data-from="0" data-to="0.6" data-opacity="0" data-translatey="100">
                            <div>
                            	
                                <h2>YOU'VE MADE A <span>BRAVE</span> DECISION, WELCOME.</h2>
                                <p></p>
				    			
                                <h2></h2>
                                <p>A LITTLE BIT MORE FAST,A LITTLE BIT MORE STRONG。</p>
				    			

                            </div>
                        </div>
                    </div>
                    <!-- // .col-md-12 -->
                </div>
                <div class="herofade beige-dk"></div>
            </div>
        </section>

        <!-- Height spacing helper -->
        <div class="heightblock"></div>
        <!-- // End height spacing helper -->

        <!-- ============================ END Hero Image =========================== -->
      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2015-09-12T15:27:16.000Z" itemprop="datePublished">
          2015-09-12
      </time>
    
    
    | 
    <a href='/tags/Flask-Admin-Flask/'>Flask-Admin Flask</a>
    
    
</span>
                <h1>Flask-Admin入门</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<p>工作中要提供一个简易的可视化web界面供用户（开发者？）方便地查看数据库的内容，可以的话最好还能对数据库进行增删改查，flask-Admin就是我想要的！</p>
<p><strong>Flask-Admin是什么？</strong></p>
<p>Flask-Admin是Flask框架的一个扩展，用它能够快速创建Web管理界面，它实现了比如用户、文件的增删改查等常用的管理功能；如果对它的默认界面不喜欢，可以通过修改模板文件来定制；</p>
<p>Flask-Admin把每一个菜单（超链接）看作一个view，注册后才能显示出来，view本身也有属性来控制其是否可见；因此，利用这个机制可以定制自己的模块化界面，比如让不同权限的用户登录后看到不一样的菜单；</p>
<p><strong>如何使用</strong></p>
<p>Flask-Admin的文档写得比较简单，单从文档很难理解如何使用，好在作者提供了的很多Example（见 源码 ），基本上照葫芦画瓢即可；</p>
<p>下面就通过分析一些Example代码来学习使用</p>
<p><strong>example/simple</strong></p>
<p>这是最简单的一个样例，可以帮助我们快速、直观的了解基本概念，学会定制Flask-Admin的界面</p>
<p><code>simple.py</code> ：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask.ext <span class="keyword">import</span> admin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create custom admin view</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyAdminView</span><span class="params">(admin.BaseView)</span>:</span></span><br><span class="line"><span class="meta">    @admin.expose('/')</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.render(<span class="string">'myadmin.html'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnotherAdminView</span><span class="params">(admin.BaseView)</span>:</span></span><br><span class="line"><span class="meta">    @admin.expose('/')</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.render(<span class="string">'anotheradmin.html'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @admin.expose('/test/')</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.render(<span class="string">'test.html'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create flask app</span></span><br><span class="line">app = Flask(__name__, template_folder=<span class="string">'templates'</span>)</span><br><span class="line">app.debug = <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Flask views</span></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Click me to get to Admin!'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create admin interface</span></span><br><span class="line">admin = admin.Admin()</span><br><span class="line">admin.add_view(MyAdminView(category=<span class="string">'Test'</span>))</span><br><span class="line">admin.add_view(AnotherAdminView(category=<span class="string">'Test'</span>))</span><br><span class="line">admin.init_app(app)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Start app</span></span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure></p>
<p><strong>BaseView</strong></p>
<p>所有的view都必须继承自 BaseView ：</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> BaseView(<span class="keyword">name</span>=<span class="keyword">None</span>, category=<span class="keyword">None</span>, endpoint=<span class="keyword">None</span>, url=<span class="keyword">None</span>, static_folder=<span class="keyword">None</span>, static_url_path=<span class="keyword">None</span>)</span><br></pre></td></tr></table></figure>
<p>name: view在页面上表现为一个menu（超链接），menu name == ‘name’，缺省就用小写的class name<br>category: 如果多个view有相同的category就全部放到一个dropdown里面（dropdown name==’category’）<br>endpoint: 假设endpoint=’xxx’，则可以用 <code>url_for(xxx.index)</code> ，也能改变页面URL（ <code>/admin/xxx</code> ）<br>url: 页面URL，优先级 <code>url &gt; endpoint &gt; class name</code><br>static_folder: static目录的路径<br>static_url_path: static目录的URL<br><code>anotheradmin.html</code> :<br><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="name">extends</span></span> 'admin/master.html' %&#125;</span><span class="xml"></span><br><span class="line"></span><span class="template-tag">&#123;% <span class="name"><span class="name">block</span></span> body %&#125;</span><span class="xml"></span><br><span class="line">    Hello World from AnotherMyAdmin!</span><br><span class="line"></span><br><span class="line">    Click me to go to test view</span><br><span class="line"></span><span class="template-tag">&#123;% <span class="name"><span class="name">endblock</span></span> %&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure></p>
<p>如果 <code>AnotherAdminView</code> 增加参数 <code>endpoint=&#39;xxx&#39;</code> ，那这里就可以写成 <code>url_for(&#39;xxx.text&#39;)</code> ，然后页面URL会由 <code>/admin/anotheradminview/</code> 变成 <code>/admin/xxx</code></p>
<p>如果同时指定参数 <code>url=&#39;aaa&#39;</code> ，那页面URL会变成 <code>/admin/aaa</code> ，url优先级比endpoint高</p>
<p><strong>Admin</strong></p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Admin(app=<span class="keyword">None</span>, <span class="keyword">name</span>=<span class="keyword">None</span>, url=<span class="keyword">None</span>, subdomain=<span class="keyword">None</span>, index_view=<span class="keyword">None</span>, translations_path=<span class="keyword">None</span>, endpoint=<span class="keyword">None</span>, static_url_path=<span class="keyword">None</span>, base_template=<span class="keyword">None</span>)</span><br></pre></td></tr></table></figure>
<p>app: Flask Application Object；本例中可以不写 <code>admin.init_app(app)</code> ，直接用 <code>admin = admin.Admin(app=app)</code> 是一样的<br>name: Application name，缺省’Admin’；会显示为main menu name(‘Home’左边的’Admin’)和page title<br>subdomain: ???<br>index_view: ‘Home’那个menu对应的就叫index view，缺省 <code>AdminIndexView</code><br>base_template: 基础模板，缺省 <code>admin/base.html</code> ，该模板在Flask-Admin的源码目录里面<br>部分Admin代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MenuItem</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""</span><br><span class="line">        Simple menu tree hierarchy.</span><br><span class="line">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, view=None)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self._view = view</span><br><span class="line">        self._children = []</span><br><span class="line">        self._children_urls = set()</span><br><span class="line">        self._cached_url = <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line">        self.url = <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">if</span> view <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            self.url = view.url</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_child</span><span class="params">(self, view)</span>:</span></span><br><span class="line">        self._children.append(view)</span><br><span class="line">        self._children_urls.add(view.url)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, app=None, name=None,</span><br><span class="line">                 url=None, subdomain=None,</span><br><span class="line">                 index_view=None,</span><br><span class="line">                 translations_path=None,</span><br><span class="line">                 endpoint=None,</span><br><span class="line">                 static_url_path=None,</span><br><span class="line">                 base_template=None)</span>:</span></span><br><span class="line"></span><br><span class="line">        self.app = app</span><br><span class="line"></span><br><span class="line">        self.translations_path = translations_path</span><br><span class="line"></span><br><span class="line">        self._views = []</span><br><span class="line">        self._menu = []</span><br><span class="line">        self._menu_categories = dict()</span><br><span class="line">        self._menu_links = []</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> name <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            name = <span class="string">'Admin'</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">        self.index_view = index_view <span class="keyword">or</span> AdminIndexView(endpoint=endpoint, url=url)</span><br><span class="line">        self.endpoint = endpoint <span class="keyword">or</span> self.index_view.endpoint</span><br><span class="line">        self.url = url <span class="keyword">or</span> self.index_view.url</span><br><span class="line">        self.static_url_path = static_url_path</span><br><span class="line">        self.subdomain = subdomain</span><br><span class="line">        self.base_template = base_template <span class="keyword">or</span> <span class="string">'admin/base.html'</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Add predefined index view</span></span><br><span class="line">        self.add_view(self.index_view)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Register with application</span></span><br><span class="line">        <span class="keyword">if</span> app <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            self._init_extension()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_view</span><span class="params">(self, view)</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Add to views</span></span><br><span class="line">        self._views.append(view)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># If app was provided in constructor, register view with Flask app</span></span><br><span class="line">        <span class="keyword">if</span> self.app <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            self.app.register_blueprint(view.create_blueprint(self))</span><br><span class="line">            self._add_view_to_menu(view)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_add_view_to_menu</span><span class="params">(self, view)</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> view.category:</span><br><span class="line">            category = self._menu_categories.get(view.category)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> category <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">                category = MenuItem(view.category)</span><br><span class="line">                self._menu_categories[view.category] = category</span><br><span class="line">                self._menu.append(category)</span><br><span class="line"></span><br><span class="line">            category.add_child(MenuItem(view.name, view))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self._menu.append(MenuItem(view.name, view))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init_app</span><span class="params">(self, app)</span>:</span></span><br><span class="line"></span><br><span class="line">        self.app = app</span><br><span class="line"></span><br><span class="line">        self._init_extension()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Register views</span></span><br><span class="line">        <span class="keyword">for</span> view <span class="keyword">in</span> self._views:</span><br><span class="line">            app.register_blueprint(view.create_blueprint(self))</span><br><span class="line">            self._add_view_to_menu(view)</span><br></pre></td></tr></table></figure>
<p>从上面的代码可以看出 <code>init_app(app)</code> 和 <code>Admin(app=app)</code> 是一样的：</p>
<p>将每个view注册为blueprint（Flask里的概念，可以简单理解为模块）<br>记录所有view，以及所属的category和url</p>
<p><strong>AdminIndexView</strong><br><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> AdminIndexView(<span class="keyword">name</span>=<span class="keyword">None</span>, category=<span class="keyword">None</span>, endpoint=<span class="keyword">None</span>, url=<span class="keyword">None</span>, template=<span class="string">'admin/index.html'</span>)</span><br></pre></td></tr></table></figure></p>
<p>-name: 缺省’Home’<br>-endpoint: 缺省’admin’<br>-url: 缺省’/admin’<br>如果要封装出自己的view，可以参照 <code>AdminIndexView</code> 的写法：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AdminIndexView</span><span class="params">(BaseView)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name=None, category=None,</span><br><span class="line">                 endpoint=None, url=None,</span><br><span class="line">                 template=<span class="string">'admin/index.html'</span>)</span>:</span></span><br><span class="line">        super(AdminIndexView, self).__init__(name <span class="keyword">or</span> babel.lazy_gettext(<span class="string">'Home'</span>),</span><br><span class="line">                                             category,</span><br><span class="line">                                             endpoint <span class="keyword">or</span> <span class="string">'admin'</span>,</span><br><span class="line">                                             url <span class="keyword">or</span> <span class="string">'/admin'</span>,</span><br><span class="line">                                             <span class="string">'static'</span>)</span><br><span class="line">        self._template = template</span><br><span class="line"></span><br><span class="line"><span class="meta">    @expose()</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.render(self._template)</span><br></pre></td></tr></table></figure></p>
<p><strong>base_template</strong></p>
<p>base_template缺省是 <code>/admin/base.html</code> ，是页面的主要代码（基于 bootstrap ），它里面又import <code>admin/layout.html</code> ；</p>
<p>layout是一些宏，主要用于展开、显示menu；</p>
<p>在模板中使用一些变量来取出之前注册view时保存的信息（如menu name和url等）：</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"># admin/layout.html (部分) </span><br><span class="line"></span><span class="template-tag">&#123;% <span class="name">macro</span> menu() %&#125;</span><span class="xml"></span><br><span class="line">  </span><span class="template-tag">&#123;% <span class="name"><span class="name">for</span></span> item <span class="keyword">in</span> admin_view.admin.menu() %&#125;</span><span class="xml"></span><br><span class="line">    </span><span class="template-tag">&#123;% <span class="name"><span class="name">if</span></span> item.is_category() %&#125;</span><span class="xml"></span><br><span class="line">      </span><span class="template-tag">&#123;% <span class="name">set</span> children = item.get_children() %&#125;</span><span class="xml"></span><br><span class="line">      </span><span class="template-tag">&#123;% <span class="name"><span class="name">if</span></span> children %&#125;</span><span class="xml"></span><br><span class="line">        </span><span class="template-tag">&#123;% <span class="name"><span class="name">if</span></span> item.is_active(admin_view) %&#125;</span><span class="xml"></span><br><span class="line"></span><span class="template-tag">&#123;% <span class="name"><span class="name">else</span></span> %&#125;</span><span class="xml"></span><br><span class="line"></span><span class="template-tag">&#123;% <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="xml"></span><br><span class="line">          </span><span class="template-variable">&#123;&#123; item.name &#125;&#125;</span><span class="xml"></span><br><span class="line">          </span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">      </span><span class="template-tag">&#123;% <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="xml"></span><br><span class="line">    </span><span class="template-tag">&#123;% <span class="name"><span class="name">else</span></span> %&#125;</span><span class="xml"></span><br><span class="line">      </span><span class="template-tag">&#123;% <span class="name"><span class="name">if</span></span> item.is_accessible() and item.is_visible() %&#125;</span><span class="xml"></span><br><span class="line">        </span><span class="template-tag">&#123;% <span class="name"><span class="name">if</span></span> item.is_active(admin_view) %&#125;</span><span class="xml"></span><br><span class="line"></span><span class="template-tag">&#123;% <span class="name"><span class="name">else</span></span> %&#125;</span><span class="xml"></span><br><span class="line"></span><span class="template-tag">&#123;% <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="xml"></span><br><span class="line">          </span><span class="template-variable">&#123;&#123; item.name &#125;&#125;</span><span class="xml"></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">      </span><span class="template-tag">&#123;% <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="xml"></span><br><span class="line">    </span><span class="template-tag">&#123;% <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="xml"></span><br><span class="line">  </span><span class="template-tag">&#123;% <span class="name"><span class="name">endfor</span></span> %&#125;</span><span class="xml"></span><br><span class="line"></span><span class="template-tag">&#123;% <span class="name">endmacro</span> %&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure>
<p><strong>example/file</strong></p>
<p>这个样例能帮助我们快速搭建起文件管理界面，但我们的重点是学习使用 <code>ActionsMixin</code> 模块</p>
<p><code>file.py</code> ：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> os.path <span class="keyword">as</span> op</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask.ext <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> flask.ext.admin.contrib <span class="keyword">import</span> fileadmin</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create flask app</span></span><br><span class="line">app = Flask(__name__, template_folder=<span class="string">'templates'</span>, static_folder=<span class="string">'files'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create dummy secrey key so we can use flash</span></span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = <span class="string">'123456790'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Flask views</span></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Click me to get to Admin!'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># Create directory</span></span><br><span class="line">    path = op.join(op.dirname(__file__), <span class="string">'files'</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        os.mkdir(path)</span><br><span class="line">    <span class="keyword">except</span> OSError:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Create admin interface</span></span><br><span class="line">    admin = admin.Admin(app)</span><br><span class="line">    admin.add_view(fileadmin.FileAdmin(path, <span class="string">'/files/'</span>, name=<span class="string">'Files'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Start app</span></span><br><span class="line">    app.run(debug=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure></p>
<p>FileAdmin是已经写好的的一个view，直接用即可：<br><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="type">FileAdmin</span>(<span class="title">base_path</span>, <span class="title">base_url</span>, <span class="title">name</span>=<span class="type">None</span>, <span class="title">category</span>=<span class="type">None</span>, <span class="title">endpoint</span>=<span class="type">None</span>, <span class="title">url</span>=<span class="type">None</span>, <span class="title">verify_path</span>=<span class="type">True</span>)</span></span><br></pre></td></tr></table></figure></p>
<p>-base_path: 文件存放的相对路径<br>-base_url: 文件目录的URL<br>FileAdmin中和ActionsMixin相关代码如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileAdmin</span><span class="params">(BaseView, ActionsMixin)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, base_path, base_url,</span><br><span class="line">                 name=None, category=None, endpoint=None, url=None,</span><br><span class="line">                 verify_path=True)</span>:</span></span><br><span class="line"></span><br><span class="line">        self.init_actions()</span><br><span class="line"></span><br><span class="line"><span class="meta">@expose('/action/', methods=('POST',))</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">action_view</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> self.handle_action()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Actions</span></span><br><span class="line"><span class="meta">@action('delete',</span></span><br><span class="line">        lazy_gettext(<span class="string">'Delete'</span>),</span><br><span class="line">        lazy_gettext(<span class="string">'Are you sure you want to delete these files?'</span>))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">action_delete</span><span class="params">(self, items)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> self.can_delete:</span><br><span class="line">        flash(gettext(<span class="string">'File deletion is disabled.'</span>), <span class="string">'error'</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> path <span class="keyword">in</span> items:</span><br><span class="line">        base_path, full_path, path = self._normalize_path(path)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.is_accessible_path(path):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                os.remove(full_path)</span><br><span class="line">                flash(gettext(<span class="string">'File "%(name)s" was successfully deleted.'</span>, name=path))</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">                flash(gettext(<span class="string">'Failed to delete file: %(name)s'</span>, name=ex), <span class="string">'error'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@action('edit', lazy_gettext('Edit'))</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">action_edit</span><span class="params">(self, items)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">'.edit'</span>, path=items))</span><br></pre></td></tr></table></figure></p>
<p><code>@action()</code> 用于wrap跟在后面的函数，这里的作用就是把参数保存起来：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">action</span><span class="params">(name, text, confirmation=None)</span></span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrap</span><span class="params">(f)</span></span>:</span><br><span class="line">        f._action = (name, text, confirmation)</span><br><span class="line">        <span class="keyword">return</span> f</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrap</span><br></pre></td></tr></table></figure></p>
<p>-name: action name<br>-text: 可用于按钮名称<br>-confirmation: 弹框确认信息<br><code>init_actions()</code> 把所有action的信息保存到 <code>ActionsMixin</code> 里面：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 调试信息</span></span><br><span class="line">_actions = [(<span class="string">'delete'</span>, l<span class="string">u'Delete'</span>), (<span class="string">'edit'</span>, l<span class="string">u'Edit'</span>)]</span><br><span class="line">_actions_data = &#123;<span class="string">'edit'</span>: (&gt;, l<span class="string">u'Edit'</span>, <span class="keyword">None</span>), <span class="string">'delete'</span>: (&gt;, l<span class="string">u'Delete'</span>, l<span class="string">u'Are you sure you want to delete these files?'</span>)&#125;</span><br></pre></td></tr></table></figure>
<p><code>action_view()</code> 用于处理POST给 <code>/action/</code> 的请求，然后调用 <code>handle_action()</code> ，它再调用不同的action处理，最后返回当前页面：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 省略无关代码</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_action</span><span class="params">(self, return_view=None)</span>:</span></span><br><span class="line"></span><br><span class="line">    action = request.form.get(<span class="string">'action'</span>)</span><br><span class="line">    ids = request.form.getlist(<span class="string">'rowid'</span>)</span><br><span class="line"></span><br><span class="line">    handler = self._actions_data.get(action)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> handler <span class="keyword">and</span> self.is_action_allowed(action):</span><br><span class="line">        response = handler[<span class="number">0</span>](ids)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> response <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> return_view:</span><br><span class="line">        url = url_for(<span class="string">'.'</span> + self._default_view)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        url = url_for(<span class="string">'.'</span> + return_view)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> redirect(url)</span><br></pre></td></tr></table></figure>
<p>ids是一个文件清单，作为参数传给action处理函数（参数items）：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 调试信息</span></span><br><span class="line">ids: [<span class="string">u'1.png'</span>, <span class="string">u'2.png'</span>]</span><br></pre></td></tr></table></figure></p>
<p>再分析页面代码， <code>Files</code> 页面对应文件为 <code>admin/file/list.html</code> ，重点看 <code>With selected</code> 下拉菜单相关代码：</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name">import</span> 'admin/actions.html' <span class="keyword">as</span> actionslib with context %&#125;</span><span class="xml"></span><br><span class="line"></span><br><span class="line"></span><span class="template-tag">&#123;% <span class="name"><span class="name">if</span></span> actions %&#125;</span><span class="xml"></span><br><span class="line">    </span><span class="template-variable">&#123;&#123; actionslib.dropdown(actions, 'dropdown-toggle btn btn-large') &#125;&#125;</span><span class="xml"> </span><br><span class="line"></span><span class="template-tag">&#123;% <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="xml"></span><br><span class="line"></span><br><span class="line"></span><span class="template-tag">&#123;% <span class="name"><span class="name">block</span></span> actions %&#125;</span><span class="xml"></span><br><span class="line">    </span><span class="template-variable">&#123;&#123; actionslib.form(actions, url_for('.action_view')) &#125;&#125;</span><span class="xml"></span><br><span class="line"></span><span class="template-tag">&#123;% <span class="name"><span class="name">endblock</span></span> %&#125;</span><span class="xml"></span><br><span class="line"></span><br><span class="line"></span><span class="template-tag">&#123;% <span class="name"><span class="name">block</span></span> tail %&#125;</span><span class="xml"></span><br><span class="line">    </span><span class="template-variable">&#123;&#123; actionslib.script(_gettext('Please select at least one file.'),</span><br><span class="line">                      actions,</span><br><span class="line">                      actions_confirmation) &#125;&#125;</span><span class="xml"></span><br><span class="line"></span><span class="template-tag">&#123;% <span class="name"><span class="name">endblock</span></span> %&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure>
<p>上面用到的三个宏在 <code>actions.html</code> ：</p>
<figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="keyword">macro</span></span> dropdown(actions, btn_class='dropdown-toggle') -%&#125;</span><span class="xml"></span><br><span class="line">    </span><span class="template-variable">&#123;&#123; _gettext('With selected') &#125;&#125;</span><span class="xml"></span><br><span class="line">    </span><br><span class="line"></span><span class="template-tag">&#123;% <span class="name"><span class="keyword">endmacro</span></span> %&#125;</span><span class="xml"></span><br><span class="line"></span><br><span class="line"></span><span class="template-tag">&#123;% <span class="name"><span class="keyword">macro</span></span> form(actions, url) %&#125;</span><span class="xml"></span><br><span class="line">    </span><span class="template-tag">&#123;% <span class="name"><span class="keyword">if</span></span> actions %&#125;</span><span class="xml"></span><br><span class="line">    </span><br><span class="line">    </span><span class="template-tag">&#123;% <span class="name"><span class="keyword">endif</span></span> %&#125;</span><span class="xml"></span><br><span class="line"></span><span class="template-tag">&#123;% <span class="name"><span class="keyword">endmacro</span></span> %&#125;</span><span class="xml"></span><br><span class="line"></span><br><span class="line"></span><span class="template-tag">&#123;% <span class="name"><span class="keyword">macro</span></span> script(message, actions, actions_confirmation) %&#125;</span><span class="xml"></span><br><span class="line">    </span><span class="template-tag">&#123;% <span class="name"><span class="keyword">if</span></span> actions %&#125;</span><span class="xml"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><span class="template-tag">&#123;% <span class="name"><span class="keyword">endif</span></span> %&#125;</span><span class="xml"></span><br><span class="line"></span><span class="template-tag">&#123;% <span class="name"><span class="keyword">endmacro</span></span> %&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure>
<p>选择菜单后的处理方法在 <code>actions.js</code> :<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> AdminModelActions = <span class="function"><span class="keyword">function</span>(<span class="params">actionErrorMessage, actionConfirmations</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Actions helpers. <span class="doctag">TODO:</span> Move to separate file</span></span><br><span class="line">    <span class="keyword">this</span>.execute = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> selected = $(<span class="string">'input.action-checkbox:checked'</span>).size();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (selected === <span class="number">0</span>) &#123;</span><br><span class="line">            alert(actionErrorMessage);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> msg = actionConfirmations[name];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!!msg)</span><br><span class="line">            <span class="keyword">if</span> (!confirm(msg))</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Update hidden form and submit it</span></span><br><span class="line">        <span class="keyword">var</span> form = $(<span class="string">'#action_form'</span>);</span><br><span class="line">        $(<span class="string">'#action'</span>, form).val(name);</span><br><span class="line"></span><br><span class="line">        $(<span class="string">'input.action-checkbox'</span>, form).remove();</span><br><span class="line">        $(<span class="string">'input.action-checkbox:checked'</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            form.append($(<span class="keyword">this</span>).clone());</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        form.submit();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $(<span class="string">'.action-rowtoggle'</span>).change(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            $(<span class="string">'input.action-checkbox'</span>).attr(<span class="string">'checked'</span>, <span class="keyword">this</span>.checked);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>对比一下修改前后的表单：<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 初始化</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta"># 'Delete'选中的三个文件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta"># 'Edit'选中的一个文件</span></span><br></pre></td></tr></table></figure></p>
<p>总结一下，当我们点击下拉菜单中的菜单项（Delete,Edit），本地JavaScript代码会弹出确认框（假设有确认信息），然后提交一个表单给 <code>/admin/fileadmin/action/</code> ，请求处理函数 <code>action_view()</code> 根据表单类型再调用不同的action处理函数，最后返回一个页面。</p>

            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="pagination" role="pagination">
    
    <a class="pull-left" href="/2015/09/20/python删除文件示例分享/" style="float: left;">
        ← python删除文件示例分享
    </a>
    
    
    <a class="pull-right" href="/2015/09/04/Python-logging模块详解/">
        Python logging模块详解 →
    </a>
    
</nav>

        <div class="duoshuo">
<div class="ds-thread" data-thread-key="2015/09/12/Flask-Admin入门/" data-title="Flask-Admin入门" data-url="http://yoursite.com/2015/09/12/Flask-Admin入门/"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"duoshuo_name"};
(function() {
	var ds = document.createElement('script');
	ds.type = 'text/javascript';ds.async = true;
	ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
	ds.charset = 'UTF-8';
	(document.getElementsByTagName('head')[0] 
	 || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>
</div>
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By 钟蔚蔚. All Rights Reserved.
                </p>
                <p>Theme By <a href="//go.kieran.top" style="color: #767D84">Kieran</a></p>
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/cspilgrimzww" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    
                    
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<!-- ============================ END Footer =========================== -->
      <!-- Load our scripts -->
        
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };
    
    resizeHero();
    
    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/jquery.flexslider-min.js"></script><!-- Flexslider plugin -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->

<!-- Initiate flexslider plugin -->
<script type="text/javascript">
    $(document).ready(function($) {
      $('.flexslider').flexslider({
        animation: "fade",
        prevText: "",
        nextText: "",
        directionNav: true
      });
    });
</script>

</body>
</html>
